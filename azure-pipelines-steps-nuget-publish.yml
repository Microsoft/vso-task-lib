steps:

- task: NuGetToolInstaller@1
  inputs:
    versionSpec: '>=6.7.0'
    
- task: MSBuild@1
  inputs:
    solution: '$(Build.SourcesDirectory)/powershell/CompiledHelpers/VstsTaskSdk.csproj'
    configuration: 'Release'
    msbuildArguments: '/p:OutDir=../VstsTaskSdk'
    clean: true
    msbuildVersion: '15.0'
    msbuildArchitecture: 'x86'

- task: NuGetCommand@2
  inputs:
    command: 'pack'
    packagesToPack: 'powershell/VstsTaskSdk'
    versioningScheme: 'off'
  
- task: NuGetCommand@2
  inputs:
    command: 'push'
    packagesToPush: '$(Build.ArtifactStagingDirectory)/**/*.nupkg;!$(Build.ArtifactStagingDirectory)/**/*.symbols.nupkg'
    nuGetFeedType: 'external'
    publishFeedCredentials: 'vststasksdk-feed'
    allowPackageConflicts: true